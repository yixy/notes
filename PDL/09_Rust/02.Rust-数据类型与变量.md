# Rust-数据类型与变量

## 1. 数据类型

rust是强类型语言，编译期就明确所有变量的类型。

### 标量类型

一个标量类型代表一个值，**rust的基础标量类型**包括整数、浮点、布尔、字符等类型。

整数默认类型是i32，浮点数默认类型是f64。字符类型是Unicode标量值，可以表示比ASCII多得多的字符内容。

### 复合类型

**复合类型**可以将多个值放在一个类型里，rust的基础复合类型包括Tuple和数组，此外还包括结构体、枚举和联合体。

数组的长度是固定的，其中各个元素类型必须相同。tuple的长度是固定的，其中各元素类型可不同。

数组在stack上分配。

结构体（Struct）、元组（Tuple），枚举（Enum），联合体（Union）等本身在栈上分配，它们的字段也可能指向堆上分配的数据，取决于其值的类型。

注意，Tuple 是一个将多个值组合成一个复合值的方式，值可以是不同类型的。Tuple 的大小是固定的，不能在创建后改变。以下是如何使用 Tuple 的示例：

```rust
let t = (1, "hello"); // 创建一个新的 Tuple
let (x, y) = t; // 使用模式匹配来解构 Tuple
let first = t.0; // 通过索引访问 Tuple 中的值
```

在 Rust 中，Tuple 的分配方式（堆或栈）取决于它的内容。如果 Tuple 的所有元素都是在栈上分配的类型，那么整个 Tuple 也会在栈上分配。如果 Tuple 包含一个或多个在堆上分配的类型（如 Box<T>、String 或 Vec<T>），那么这些元素的数据会在堆上分配，而 Tuple 的 "结构"（即元素的地址和引用）会在栈上分配。

```rust
let tuple = (1, 2.0, 'a'); // 这个 Tuple 在栈上分配，因为所有元素都是在栈上分配的类型
let heap_tuple = (1, Box::new(2)); // 这个 Tuple 的 "结构" 在栈上分配，而 Box::new(2) 在堆上分配
```

### 标准库集合复合类型

String，Vector和HashMap都属于 Rust 中的集合类型，这是复合类型的一种。集合类型用于存储多个值。这些值可能具有相同的类型（如 Vector），或可能有不同的类型（如 HashMap）。

String: 这是 Rust 的字符串类型，用于存储 UTF-8 编码的字符串数据。

Vector (Vec): 这是一个可增长的列表（即，动态数组），所有元素都具有相同的类型。Vec<T> 表示类型为 T 的元素的向量。

HashMap: 这是一个哈希表，是一种关联数组，提供了键/值存储。它通过哈希函数将键映射到值，允许快速查找键对应的值。HashMap<K, V> 表示类型为 K 的键和类型为 V 的值的哈希映射。

注意，这些类型都属于 Rust 的标准库，而不是语言的核心部分。这意味着它们在某些情况下可能不可用，例如在没有标准库的环境中，如裸机或内核编程。

vector、String、Hashmap等的长度是可变的，在堆上分配。

### 切片与引用 & 指针

Rust 还支持引用类型和原始指针类型，它们并不直接对应于标量和复合类型

**切片（Slice）是 Rust 中一种没有所有权的数据类型，它并不拥有它所引用的内存。** 它的作用是引用序列的一部分，不管是数组、字符串还是 Vec。切片的长度在编译时并不是固定的。当你创建一个切片时，你实际上创建了一个包含起始位置指针和长度的两元素组合。指针指向序列中的第一个元素，长度代表从起始位置开始的元素总数。尽管有时切片数据在堆上，切片本身的结构（即指针和长度）是在栈上存储的。

无论是引用还是切片，它们都允许你访问数据（两者都是借用），而不需要拥有这些数据的所有权。这意味着你可以使用这些工具来处理数据，而不必担心数据在处理过程中被移动或删除。默认情况下，无论是引用还是切片，都不允许你改变它们指向的数据。要改变数据，你需要使用可变引用（&mut T）或者可变切片（&mut [T]）。

```rust
let s = String::from("hello");  // s 是一个 String
let r = &s;  // r 是一个引用
let slice = &s[0..2];  // slice 是一个切片
```

## 2. 变量和可变性

使用**let**声明不可变变量，增加**mut**关键字可以声明可变变量。rust变量支持类型推断，注意，如果有多个可能类型则需显式指定类型。

rust中变量具有**shadowing**特性，即可以使用相同标识符声明新的变量，新变量会shadow之前声明的同名变量，新变量可以具有不同的变量。

使用**const**声明常量，常量必须明确类型（不支持类型推断）。

