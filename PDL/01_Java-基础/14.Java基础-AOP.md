# Java基础-AOP

AOP是软件开发思想发展到一定阶段的产物，但AOP的出现并不是要完全替代OOP，而仅是作为OOP的有益补充。AOP的应用场合是受限的，它一般只适合于那些具有横切逻辑的应用场合：如性能监测、访问控制、事务管理以及日志记录（虽然有很多文章用日志记录作为讲解AOP的实例，但很多人认为很难用AOP编写实用的程序日志）。

## 1. AOP是什么

* AOP：是Aspect Oriented Programing的简称，即面向切面编程。

我们无法通过抽象父类的方式消除重复性横切代码，因为这些横切逻辑依附在业务类方法的流程中，它们不能转移到其他地方去。 

AOP独辟蹊径通过横向抽取机制为这类无法通过纵向继承体系进行抽象的重复性代码提供了解决方案。对于习惯了纵向抽取的开发者来说，可能不容易理解横向抽取方法的工作机制，因为Java语言本身不直接提供这种横向抽象的能力，我们暂把具体实现放在一旁，先通过图解的方式归纳出AOP的解决思路。

![](https://raw.githubusercontent.com/yixy4app/images/picgo/202306042058128.jpg)

可以看出AOP希望将这些分散在各个业务逻辑代码中的相同代码，通过横向切割的方式抽取到一个独立的模块中，还业务逻辑类一个清新的世界。 

当然，我们知道将这些重复性的横切逻辑独立出来是很容易的，但如何将这些独立的逻辑融合到业务逻辑中完成和原来一样的业务操作，这才是事情的关键，也正是AOP要解决的主要问题。 

## 2. AOP实现原理

根据不同的实现技术，AOP有三种实现的方式： 

1. 编译期注入，这要求使用特殊的Java编译器； 
2. 类装载期注入，这要求使用特殊的类装载器； 
3. 动态代理模式，基于动态代理方式，在运行期为目标类添加增强生成子类的方式。 

Spring采用动态代理方式实现AOP，而AspectJ采用编译期注入和类装载期注入的方式。 

## 3. AOP的常见实现

* AspectJ ：AspectJ是语言级的AOP实现，2001年由Xerox PARC的AOP小组发布，目前版本已经更新到1.6。AspectJ扩展了Java语言，定义了AOP语法，能够在编译期提供横切代码的织入，所以它有一个专门的编译器用来生成遵守Java字节编码规范的Class文件。主页位于http://www.eclipse.org/aspectj。 
* AspectWerkz ：基于Java的简单、动态、轻量级的AOP框架，该框架2002年就已经发布，由BEA Systems提供支持。它支持运行期或类装载期织入横切代码，所以它拥有一个特殊的类装载器。现在，AspectJ和AspectWerkz项目已经合并，以便整合两者的力量和技术创建统一的AOP平台。他们合作的第一个发布版本是AspectJ 5：扩展AspectJ语言，以基于注解的方式支持类似AspectJ的代码风格。 
* JBoss AOP ：2004年作为JBoss应用程序服务器框架的扩展功能发布。
* Spring AOP ：Spring AOP使用纯Java实现，它不需要专门的编译过程，不需要特殊的类装载器，它在运行期通过代理方式向目标类织入增强代码。Spring并不尝试提供最完整的AOP实现，相反，它侧重于提供一种和Spring IoC容器整合的AOP实现，用以解决企业级开发中的常见问题。在Spring中，我们可以无缝地将Spring AOP、IoC和AspectJ整合在一起。 

Spring AOP使用动态代理技术在运行期间织入增强的代码，主要有两种代理机制：基于JDK的动态代理；基于CGLib的动态代理。之所以使用两种代理机制，主要是因为JDK本身只提供接口的代理，而不支持类的代理。
