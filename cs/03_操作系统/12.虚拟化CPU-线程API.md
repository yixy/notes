# 虚拟化CPU-插叙:线程API

## 1 线程创建：pthread_create() ##

在 POSIX 中，使用pthread_create() 创建线程。

> 该函数有 4 个参数:thread、attr、start_routine 和 arg。第一个参数 thread 是指向 pthread_t 结构类型的指针，我们将利用这个结构与该线程交互，因此需要将它传入pthread_create()，以便将它初始化。 第二个参数 attr 用于指定该线程可能具有的任何属性。一些例子包括设置栈大小，或关于该线程调度优先级的信息。 一个属性通过单独调用 pthread_attr_init()来初始化。 有关详细信息， 请参阅手册。 但是， 在大多数情况下， 默认值就行， 我们只需传入 NULL。  第三个参数最复杂，但它实际上只是问:这个线程应该在哪个函数中运行?在 C 中， 我们把它称为一个函数指针 (function pointer) ， 这个指针告诉我们需要以下内容: 一个函数名称(start_routine) ，它被传入一个类型为 void *的参数(start_routine 后面的括号表明了这一点) ，并且它返回一个 void *类型的值(即一个 void 指针) 。第四个参数 arg 就是要传递给线程开始执行的函数的参数。

## 2 等待线程完成：pthread_join() ##

第一个是 pthread_t 类型,用于指定要等待的线程。这个变量是由线程创建函数初始化的(当你将一个指针作为参数传递给 pthread_create()时) 。如果你保留了它,就可以用它来等待该线程终止。 第二个参数是一个指针,指向你希望得到的返回值。因为函数可以返回任何东西,所以它被定义为返回一个指向 void 的指针。因为 pthread_join()函数改变了传入参数的值,所以你需要传入一个指向该值的指针,而不只是该值本身。我们常常不需要这样痛苦地打包、解包参数。如果我们不需要参数,创建线程时传入 NULL 即可。类似的,如果不需要返回值,那么 pthread_join()调用也可以传入 NULL。
