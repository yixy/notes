# TCP/IP(1)——Inernet与TCP/IP协议族 #

## 1. 因特网与TCP/IP ##

Internet是一个internet，但internet不等于Internet。

* internet：互连网。通用名词，它泛指多个计算机网络互连而组成的网络，在这些网络之间的通信协议（即通信规则）可以是任意的。
* Internet：因特网。专用名词，它用于代指一个特定的interne，即当前世界上最大的、开放的、由众多网络相互连接而成的特定计算机网络，它采用TCP/IP协议族作为通信的规则，且前身是美国的ARPANET。

虽然TCP/IP协议族被称为“TCP/IP协议族”，但实际上TCP和IP只是其中的两种协议而已。

* TCP/IP协议族：Internet采用的一组不同的网络协议，也称为Internet协议族。TCP和IP只是该协议族中的两种协议。

## 2. 分层与封装 ##

TCP/IP协议族通常被认为是一个四层协议系统，从底至上分别为：

* 链路层：也称为数据链路层或网络接口层。通常对应计算机中的网络接口卡和OS中的设备驱动程序，它们一起处理与传输介质的物理接口细节。注意，TCP/IP协议族里的链路层对应OSI协议模型中的物理层和数据链路层：物理层提供机械的、电气的、功能的和规程的特性，目的是实现启动、维护和关闭数据链路实体之间进行比特传输的物理连接；数据链路层负责实现在两台相邻机器之间的数据传输，向网络层提供一个定义良好的服务接口，从逻辑意义上构建一条性能稳定、不受传输介质类型影响的逻辑数据传输通道。
* 网络层：也称为互联网层。网络层尽可能快地把数据从源机器节点送到目的机器节点，这个过程中可能经过多个中间节点。所以网络层提供逐跳（hop-by-hop)协议，负责处理数据在网络中的活动，例如路由和处理拥塞。IP、ICMP、IGMP。
* 传输层：为两台机器（主机）上的应用程序提供端到端（end-to-end）的通信。TCP、UDP。
* 应用层：负责处理特定的应用程序细节。Telnet、FTP、SMTP、SNMP。

应用层的应用程序通常是一个用户进程，而下三层一般在OS内核中执行，尽管这不是必须的，但通常都是这样处理的。

当应用程序使用传输层传送数据时，数据被送入协议栈中，然后逐个通过每一层，直到被当作一串比特流送入网络。其中每一层对收到的数据都要增加一些首部信息（有时还会增加尾部信息）。

![package](https://github.com/yixy/image/blob/master/gitbook/package.png?raw=true)

```
网文
这里值得特别注意的是，在每一层，有不同的英文术语来对应包的概念，比如在 TCP 层的包叫做 Segment，在 IP 层的叫做 Packet，在链路层的叫做 Frame，另外和 TCP 位于同一层的 UDP 包我们一般叫做 Datagram，不同协议层里术语并不一样，好处是，在交流的时候，我们选择不同的英文单词就能预先确立是在那一层讨论协议。而 Segment、Packet、Frame、Datagram 等翻译成中文的时候，都是译为「包」，大家说读英文原版资料是不是更好，这些术语我们需要特别记忆，可以对照下图：

 +-------------+-------------------------+
 | Application |  HTTP Packet            |
 +-------------+-------------------------+
 | Transport   |  TCP Segment            |
 +-------------+-------------------------+
 | Network     |  IP Packet              |
 +-------------+-------------------------+
 | Link        |  Frame                  | 
 +-------------+-------------------------+         光纤
 | Physical    |  Bits                   | ====================> 
 +-------------+-------------------------+

```

* segment：传输层（CTP/UDP）传递给网络层（IP）的数据单元。
* packet：分组，网络层（IP）传给数据链路层的数据单元。可以是一个IP数据报（datagram）或者IP数据包的一个片（fragment）。
* datagram：也称IP数据报。
* fragment：datagram的一个片。
* frame：通过以太网传输的比特流。

> 没有完美的协议分层盒

> 为协议ICMP和IGMP定位一直是一件很棘手的事情。逻辑上，它们是IP的附属协议，所以我们把它们放在网络层；但是在报文封装的角度，ICMP和IGMP报文都被封装在IP数据报中。

> 对于ARP和RARP，也有类似的问题。在报文封装的角度，我们把它们放在数据链路层之上；但实际上更多的情况下，我们又把它们作为数据链路层协议，其原因在于逻辑上这是合理的。

## 3. Internet的地址 ##

Internet上的每个接口都有一个唯一的Internet地址（也称作IP地址）。IP地址长32bit。IP地址的管理机构是InterNIC，它只负责分配网络号，主机号分配则由对应系统管理员来分配。

* A类地址：（  0.0.0.0 到 127.255.255.255） 0     +7位网络号    +24位主机号
* B类地址：（128.0.0.0 到 191.255.255.255） 10    +14位网络号   +16位主机号
* C类地址：（192.0.0.0 到 223.255.255.255） 110   +21位网络号   +8位主机号
* D类地址：（224.0.0.0 到 239.255.255.255） 1110  +28位多播组号
* E类地址：（240.0.0.0 到 247.255.255.255） 11110 +27位备用

***多接口主机具有多个ip地址，其中每个接口对应一个ip地址***

> 计算机网络按传输技术可分为广播网络和点对点网络广播网络中所有机器共享通信信道，而点对点网络中机器是一对一连接起来的，一条信道链路只对应两台机器。对于广播网络来说，其数据链路层协议通常还会有MAC地址的概念，而对于点对点网络来说，这点则是没有的。计算机由于需要考虑接入广播网络的场景，所以都会有一个唯一的物理地址（MAC地址）。

> 计算机网络按传输距离可分为局域网、城域网、广域网。广播网络由于本身的特点，常用于短距离传输尺度的网络；相对的，点对点网络则更常用于长距离传输尺度的网络。

## 4. 端口号 ##

TCP和UDP采用16位端口号来识别应用程序。

* 1-255：专用端口。
* 256-1023：unix系统占用。
* 1024-5000：临时端口号。
* 大于5000：预留端口。

客户端口号又称为临时端口号，这是因为它通常只是在用户运行该客户程序时才存在，而服务器则只要主机开着，其服务就在运行。客户端通常对它所使用的端口号并不关心，只需保证该端口号在本机上是唯一的就可以了。

## 5. 网络中的设备 ##

TCP/IP协议族可以用于连接多个网络。

* 主机（host）：网络中运行用户的程序（也就是应用程序）的计算机，这些计算机被称为主机。
* 路由器（router）：工作在网络层，用于连接不同的网络，进行IP分组转发。路由器一般具有多个网络接口层（网络层+数据链路层），因为它需要连接多个网络进行分组转发。注意，有时候主机也可能有多个网络接口层，但我们一般不称之为路由器，除非它的功能只是将分组从一个接口转发到另一个接口。不难看出，一台机器可以同时是路由或主机，我们在不同场合下使用不同的术语。注意2，一些老的文献中，也把路由器称为网关，现在已经不这么命名了。
* 网桥（bridge）/交换机：工作在数据链路层，用于连接不同的广播网络。网桥/交换机会在自身存储存储其硬件端口与MAC地址的映射关系。一般使用网桥/交换机隔离LAN。简单来说，网桥可以看做一个端口数较少的交换机。域路由器区别在于，路由器根据ip进行转发，网桥/交换机根据MAC转发。
* 集线器（hub）：工作在物理层，用于构成冲突域（广播域）。
