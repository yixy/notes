# cache原理-缓存的读与写 #

## 1 缓存读 ##

先读缓存，如果命中则返回数据；如果未命中，则从较低层级存储（可能是低级缓存、主存，或者磁盘等）获取数据，并写入缓存后，返回数据。

## 2 缓存写 ##

**写命中策略**：

* 写直达/写通(Write Through)：信息会同时写入 Cache 和下一级存储
* 写回(Wtrite Back)：信息仅会写入 Cache，被更新的 Cache Line 只有在被替换出去的时候才会写回下一级存储

对于写回策略，每一个 Cache Line 需要 1bit 来标志当前的数据是否 dirty，该行的数据被写时，脏位置 1，当一个 dirty line 被替换的时候，该行数据需要写回下一级存储

**写缺失策略**：

* 写分配：写缺失时，将相应的主存块调入 Cache 之后再进行写操作，充分利用空间局部性
* 写不分配：写缺失时，不将主存块调入，直接更新主存，没有很好利用空间局部性

一般写分配与写回搭配，写不分配与写直达搭配

## 3 缓存平均访问时间 ##

知道了缓存命中和未命中的次数，就可以计算程序的**缓存平均访问时间** 。具体来说，给定这些值，可以按照如下公式计算 :

```
缓存平均访问时间 = (PHit*TM) + (PMiss*TD)
```

* TM表示命中成本（访问缓存的成本）
* TD表示未命中成本（访问低级别缓存/内存/磁盘的成本）
* PHit表示在缓存中找到数据的概率(命中) 
* PMiss表示在缓存中找不到数据的概率(未命中概览，或缺失率) 。PHit和 PMiss从 0.0 变化到 1.0， 并且 PMiss + PHit = 1.0。
