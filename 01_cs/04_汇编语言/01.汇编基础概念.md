# 汇编基础概念

## 1 机器语言 ##

机器语言是计算机上能直接执行的语言，是机器指令的集合。

每一种微处理器，由于硬件设计和内部结构的不同，就需要用不同的电平脉冲来控制，使它工作。所以每一种微处理器都有自己的机器指令集，也就是机器语言。

机器语言是机器指令（一台机器可以正确执行的指令）的集合，它们实际上是一系列二进制数据，计算机将之转换为一系列高低电平，以使计算机的电子器件受到驱动，进行运算。

## 2 汇编语言 ##

书写和阅读机器程序是一件很困难的事情，于是汇编语言产生了。

汇编语言的主体是汇编指令。汇编指令是汇编语言的核心，它决定来汇编语言的特性。汇编指令是机器指令便于记忆的书写格式。汇编指令通过编译器编译为机器码，由计算机最终执行。

汇编语言的指令分为三类：

* 汇编指令：机器码的助记符，有对应的机器码。
* 伪指令：没有对应的机器码，由编译器执行，计算机并不执行。
* 其他符号：如+、-、*、/等，由编译器识别，没有对应的机器码。

汇编语言书写的程序通过编译器编译可以得到机器语言，对应的编译器也叫做汇编器。

## 3 物理内存地址空间 ##

一台计算机中，通常装有多个存储器芯片，比如，主存（RAM）、系统BIOS（ROM）、显存（RAM）、显卡BIOS（ROM）、网卡BIOS（ROM）等，这些存储器芯片从物理连接上看是独立的。

以上存储器，CPU在操控它们的时候，把它们总的看作一个由若干存储单元（每个存储单元通常是1Byte）组成的逻辑存储器，这个逻辑存储器就是我们所说的**物理内存地址空间（Physical Memory Address） **。每个存储单元在物理内存地址空间中都有唯一的地址，这个唯一地址被称为**物理地址**。

根据上面的描述，每个物理存储器在这个逻辑存储器占有一个地址段，即一段地址空间。CPU在这段地址空间中读写数据，实际上就是在相对应的物理存储器中读写数据。不同计算机系统的内存地址空间分配情况是不同的。以8086内存地址空间分配为例，0x00000-0x9FFFF为主存地址空间，0xA0000-0xBFFFF为显存地址空间，0xC0000-0xFFFFF为各类ROM地址空间。

电子计算机的最小信息单位是bit，即一个二进制位。8个bit组成一个byte，即8个二进制位，存储器的容量是以字节为最小单位来计算的。

## 4 异常（Exception） ##

**异常（Exception）**是一种形式的异常控制流，他一部分是硬件实现的，一部分是由操作系统实现的。异常可以分为四类：中断（interrupt）、陷阱（trap）、故障（fault）和终止（abort）。

该部分的具体讨论见操作系统相关内容。

## 5 实模式、保护模式 ##

该部分的具体讨论见操作系统相关内容。

实模式是一种处理器运行模式，它最早出现在Intel 8086处理器上。在实模式下，处理器可以直接访问物理内存，而不需要通过分段或分页等内存管理机制。

以下是实模式的一些主要特点：

直接内存访问：在实模式下，处理器可以直接访问所有的物理内存。这使得内存管理变得简单，但同时也没有任何内存保护机制，因此一个程序的错误可能会影响到其他程序或操作系统。

16位操作：实模式通常与16位操作一起使用。例如，Intel 8086处理器是16位处理器，它在实模式下工作。这限制了处理器可以访问的内存空间，例如8086只能访问1MB的内存。

无虚拟内存：在实模式下，处理器没有虚拟内存支持。所有的内存寻址都是基于实际的物理地址，而不是虚拟地址。

实模式是最早的处理器运行模式，它在许多现代处理器中仍然存在，通常用于引导过程和某些特殊的系统任务。但是由于其内存访问和操作的限制，以及没有内存保护和虚拟内存支持，现代操作系统通常在处理器的保护模式下运行，这种模式提供了更复杂的内存管理和保护机制。

现代的CPU（如Intel的x86-64架构的处理器）通常在启动时首先进入实模式，然后切换到更复杂的运行模式，如保护模式或长模式。这是因为实模式的环境对于引导加载器和某些固件（如BIOS或UEFI）来说是简单和熟悉的，它们可以在这种环境中初始化硬件，然后加载和启动操作系统。

一旦操作系统被加载，现代的CPU就会切换到更先进的运行模式。例如，Windows, Linux, macOS等现代操作系统，通常会在保护模式或长模式下运行，这两种模式都支持如分段和分页等先进的内存管理机制，以及多任务处理，异常和中断处理等功能。

在这些模式下，操作系统可以创建一个抽象的虚拟内存空间，每个程序都认为自己是在这个空间中单独运行，从而实现内存的保护和隔离，防止程序间相互干扰。而在实模式下，由于所有程序都直接访问物理内存，一个程序的错误可能会影响到其他程序，这对于需要稳定运行的操作系统来说是不可接受的。

因此，虽然现代CPU在启动时会使用实模式，但在操作系统运行期间，通常不会使用实模式。当然，某些特殊的情况下，例如在处理某些低级硬件操作或兼容老的16位软件时，可能会切换到实模式。
