# StoredProgramComputer-中断与IO

> 关于中断与IO这块内容的详细讨论可以参考输入输相关章节。本节仅简单介绍中断。

> 异常（Exception）的 详细内容参考操作系统相关内容，以及CSAPP第8章。

**异常（Exception）**是一种形式的异常控制流，他一部分是硬件实现的，一部分是由操作系统实现的。异常可以分为四类：中断（interrupt）、陷阱（trap）、故障（fault）和终止（abort）。

## 1 中断原理 ##

提供中断主要是为了提高处理效率。实际上，大多数IO设备比处理器慢得多。如果CPU在执行了IO指令后，同步阻塞等待IO返回，那么将会大大的浪费宝贵的CPU资源。

所以，我们支持CPU在执行IO指令后并不阻塞等待IO操作完成，而是返回执行其他指令（这里假设CPU可以运行多个程序）。在CPU执行其他指令的同时，IO设备进行IO操作，当操作完成时，IO设备通过向处理器芯片上的一个管脚发送信号，并将异常号放到系统总线上，来触发中断，这个异常号表示了引起中断的设备。随后，处理器根据接收到的信号和异常号挂起当前执行任务，跳转到对应的中断处理程序进行处理（由操作系统负责），在处理完成后，继续执行原来中断前正在执行的任务。

## 2 中断周期 ##

指令周期中的中断周期负责处理中断。在中断周期中，处理器检查是否发生了中断，这将由中断请求信号的出现来指示。如果没有中断请求，则处理器继续进入取指周期，读取当前程序的下一条指令。如果出现中断请求，则处理器执行如下操作：

1. 挂起当前正在执行的程序，并保存状态（程序计数器PC的当前内容，及其他任何与处理器当前活动关联的数据）
2. 将PC设置为中断处理例程的起始地址

中断处理例程一般是操作系统所属的部分。中断处理例程结束后，处理器能够在断点处回复用户程序的执行。

## 3 多重中断 ##

当中断时发生中断有两种处理方式。一是在中断处理过程中禁止其他中断，此时其他中断会保持在“未决状态”，在处理器允许中断后就会检测到这种未决状态。这种方式的缺点在于不能考虑相对优先级和时间的紧迫性。第二终方式是定义中断的优先级，且允许高优先级中断引起低级中断处理例程本身被中断。
