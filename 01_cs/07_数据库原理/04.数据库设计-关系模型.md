# 关系模型

标准的数据库语言（SQL）是建立在关系模型基础之上的，数据库领域的众多理论也是建立在关系模型基础之上的。

关系型数据库基于关系模型，关系模型用表的集合来表示数据和数据间的关系。表中的一行代表的是一些列列值之间的关系。简单来说，一个关系就是一个表，关系模型就是用来处理表的，按数据模型的三要素来区分，它包含三个部分：

* 数据结构：描述数据的基本结构形式（table/relation）
* 数据操作：描述表之间的各种操作（关系运算）
* 数据完整性约束条件：描述关系运算（操作）所应遵循的约束条件（完整性约束）

## 1 关系模型-数据结构

* 属性与域：每个属性（对应表中的列）有一组允许的值，称为该属性的域。
* 关系：一系列域上的笛卡尔积的子集。关系是笛卡尔积中每个元组（行）的集合。

> 关系第一范式：属性不可再分

用D表示某个属性中域的值的集合，则有n个属性（列）的关系（表）可以被定义为：

```
A = D1 x D2 x ... x Dn
```

* 主键：代表被数据库设计者选中的，用来在同一关系中区分不同元组的属性组合。（主键从候选码中选择）
* 外键：一个关系模式r1可能在它的属性中包括另一个关系模式r2的主键，这个属性叫做r1的参照r2的外键。

## 2 关系模型-关系运算

### 2.1 关系代数

关系运算操作的对象及结果都是集合。

关系代数的基本运算：

* 选择：选出满足给定谓词的元组。（一元行操作）
* 投影：返回作为参数的关系的属性。由于关系是一个集合，所以重复行会被去除。（一元列操作）
* 并：若两个关系的属性相容（属性数目相同，并且对应的属性的域也相同），则两个关系可以合并。（二元行操作）
* 集合差：找出在一个关系中而不在另一个关系中的元组，要求两个关系的属性相容（即属性数目相同，并且对应的属性的域也相同）。（二元行操作 r1-r2）
* 笛卡尔积：（二元行操作 r1xr2）
* 更名：为运算结果的属性更名。（一元列操作）

> 注意细微的区别，表允许重复，关系不允许重复

附加的关系代数运算：前面提到的基本运算足以表达任何关系代数查询。但为了简化表达式，我们在基本运算以外，还定义了一些附加的其他运算，这些附加运算都可以使用基本运算推导得出。

* 集合交：r-(r-s) 
* 自然连接：r1xr2的结果上，对r1和r2都出现的属性(属性名与属性值均相同）进行选择操作，最后还要去除重复属性。
* 除(r/s)：1）s的属性与r的属性的某个真子集相容； 2）r/s 的属性，在r中但不在s中；3）(r/s)xs是集合r的子集。 
* 赋值：有时通过赋值给临时变量的方法，把关系代数表达式分成几个部分写会很简单。tmp=r

扩展的关系代数运算：允许将算术运算符作为投影的一部分。

* 广义投影：允许在投影列表中使用算术函数来对投影进行扩展。特别地，算术表达式可以仅仅是个属性或者常量。
* 聚合函数：输入值的一个集合，将单一值作为结果返回。如max()，min()，avg()，sum()等。
* 外连接：补充自然连接中不匹配的元组。1）左外连接，取出左侧关系中所有与右侧关系的任一元组都不匹配的元组，用空值填充所有来自右侧关系的属性，再把产生的元组加到自然连接结果上；2）右外连接，取出右侧关系中所有与左侧关系的任一元组都不匹配的元组，用空值填充所有来自左侧关系的属性，再把产生的元组加到自然连接结果上；3）全外连接，完成左外连接和右外连接运算
* 空值：1）空值的算术运算结果是unknown；2）空值的比较运算结果是unknown；3）布尔运算满足，and一假即假，or一真即真。

```
true and unknow = unknow
false and unknow = false
unknow and unknow = unknow
true or unknow = true
false or unknow = unknow
unknow or unknow = unknow
not unknow = unknow
```

### 2.2 元组演算

元组演算：（基于逻辑的运算）

元组演算实现关系代数：

### 2.3 域演算

域演算的定义与元组演算类似：（基于示例的运算）

## 3 关系模型—完整性约束

* 实体完整性：主键不能为空。空值是没有意义或不知道、不存在的值。
* 参照完整性：外码要么为空，要么为对应关联表的主码。
* 用户自定义完整性：属性的长度、类型等要求。

主键（PrimaryKey）唯一定义一个行（tuple）。

外键是一个表中的字段，它在另一个表中是主键。主要的目的是防止删除那些在其它表中被引用的数据，维护数据的完整性。


