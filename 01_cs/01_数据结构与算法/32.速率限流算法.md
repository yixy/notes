# 速率限流算法

## 1 漏桶算法（QPS） ##

漏桶(Leaky Bucket)算法思路很简单,水(请求)先进入到漏桶里,漏桶以一定的速度出水(接口有响应速率),当水流入速度过大会直接溢出(访问频率超过接口响应速率),然后就拒绝请求,可以看出漏桶算法能强行限制数据的传输速率.示意图如下：

![](https://raw.githubusercontent.com/yixy4app/images/picgo/202209122042321.jpg)

## 2 令牌桶算法（QPS） ##

以一个恒定的速率往桶里放入令牌。请求到达时，需要从桶里获取一个令牌，然后再进行处理。当桶里没有令牌可取时，则拒绝服务或等待。

![](https://raw.githubusercontent.com/yixy4app/images/picgo/202209122042071.jpg)

令牌：每次请求只有拿到 Token 令牌后，才可以继续访问；
桶：具有固定数量的桶，每个桶中最多只能放设计好的固定数量的令牌；
入桶频率：按照固定的频率往桶中放入令牌，放入令牌不能超过桶的容量。

因此，一个令牌桶的限流器，可以限制一个时间间隔内，最多可以承载桶容量的访问频次。

## 3 漏桶算法和令牌桶算法的区别 ##

漏桶算法与令牌桶算法的区别在于，漏桶算法能够强行限制数据的传输速率，令牌桶算法能够在限制数据的平均传输速率的同时还允许某种程度的突发传输。

需要注意的是，在某些情况下，漏桶算法不能够有效地使用网络资源，因为漏桶的漏出速率是固定的，所以即使网络中没有发生拥塞，漏桶算法也不能使某一个单独的数据流达到端口速率。因此，漏桶算法对于存在突发特性的流量来说缺乏效率。而令牌桶算法则能够满足这些具有突发特性的流量。通常，漏桶算法与令牌桶算法结合起来为网络流量提供更高效的控制。
